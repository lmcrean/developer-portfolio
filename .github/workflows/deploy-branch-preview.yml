name: Deploy Branch Preview (Single-Server)

on:
  pull_request:
    types: [opened, synchronize, reopened]
  workflow_dispatch:

permissions:
  contents: read
  pull-requests: write
  deployments: write
  checks: write

jobs:
  deploy:
    uses: ./.github/workflows/reusable-deploy.yml
    with:
      deployment_channel: 'branch-${{ github.event.number }}'
      deployment_type: 'branch'
      pr_number: '${{ github.event.number }}'
      trigger_source: 'pr'
    secrets:
      API_GITHUB_TOKEN: ${{ secrets.API_GITHUB_TOKEN }}
      FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_LAURIECREAN_FREE_38256 }}
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}